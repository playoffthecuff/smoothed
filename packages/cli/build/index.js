#!/usr/bin/env node
// @bun
import{Command as A}from"commander";import B from"inquirer";import c from"path";import d from"fs/promises";import{fileURLToPath as E}from"url";import{z as r}from"zod/v4";import{readFile as k}from"fs/promises";import x from"path";var I=r.object({path:r.string()}),b=r.object({name:r.string(),description:r.string().optional(),type:r.enum(["component","hook","util"]),files:r.array(I).min(1),dependencies:r.array(r.string()).optional(),registryDependencies:r.array(r.string()).optional()}),w=async(n,t)=>{let o=x.join(n,t),s=await k(o,"utf-8"),i=JSON.parse(s);return b.parse(i)},g=async(n,t,o=new Set)=>{if(o.has(t))return[];o.add(t);let s=[],i=await w(n,t);if(i.registryDependencies?.length)for(let e of i.registryDependencies){let a=await g(n,e,o);s.push(...a)}return[...s,i]};import l from"fs";import{exec as $}from"child_process";import{promisify as S}from"util";import D from"path";var F={bun:"bun.lock",pnpm:"pnpm-lock.yaml",yarn:"yarn.lock",npm:"package-lock.json"},O=()=>Object.entries(F).find(([n,t])=>l.existsSync(t))?.[0]??"npm",R=S($);function z(n){let t=process.cwd(),o=D.join(t,"package.json");if(!l.existsSync(o))return!1;let s=JSON.parse(l.readFileSync(o,"utf8"));return Boolean(s.dependencies?.[n]||s.devDependencies?.[n]||s.peerDependencies?.[n])}var J=async(n)=>{let t=O(),o={bun:`bun add ${n.join(" ")}`,pnpm:`pnpm add ${n.join(" ")}`,yarn:`yarn add ${n.join(" ")}`,npm:`npm install ${n.join(" ")}`}[t];if(console.log(`\uD83D\uDCE6 Installing ${n.join(", ")} using ${t}...`),o)await R(o)},f=async(n)=>{let t=n.filter((o)=>!z(o));if(t.length===0){console.log(`\u2714 All deps already installed: ${n.join(", ")}`);return}console.log(`\uD83D\uDCE6 Installing ${t.join(", ")}`);try{await J(t)}catch(o){console.error("\u274C Install error:",o)}};var m=new A,M=E(import.meta.url),j=c.dirname(M);m.command("add [name]").description("Add component to your project").action(async(n)=>{if(!n){let{component:e}=await B.prompt([{type:"input",name:"component",message:"Component name:"}]);n=e}let t=c.join(process.cwd(),"src"),o=c.join(j,"../src","registry","schema"),s=c.join(j,"../src","templates"),i=await g(o,n.toLowerCase()+".json");for(let e of i){if(e.dependencies?.length)await f(e.dependencies);if(e.files.length)for(let a of e.files){let{type:p}=e,u=c.join(s,p+"s",a.path),y=c.join(t,p==="component"?"components/ui":p+"s",a.path);await d.mkdir(c.dirname(y),{recursive:!0}),await d.copyFile(u,y)}}});m.parse();
